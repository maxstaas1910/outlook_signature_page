<!DOCTYPE html>
<html lang="en">
<!--TODO fix help button and style help page-->
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/purecss@3.0.0/build/pure-min.css" integrity="sha384-X38yfunGUhNzHpBaEBsWLO+A0HDYOQi8ufWDkZ0k9e0eXz/tH3II7uKZ9msv++Ls" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/purecss@3.0.0/build/grids-responsive-min.css" />
    <title>Outlook Signature Tool</title>
</head>
<body>
<div id="germancontent" style="display: none">
<div class="inputbox">
    <div class="content">
        <div id="languagebuttons" style="text-align: right; font-size:20px">
            <button id="germanbutton" class="languagebutton" onclick="setLanguage('german')">&#x1F1E9;&#x1F1EA;</button>
            <button id="englishbutton" class="languagebutton" onclick="setLanguage('english')">&#x1F1EC;&#x1F1E7;</button>
        </div>
        <h2><span style="color: #D4021D">OTTO</span> Signatur erstellen oder aktualisieren</h2>
        <form id="inputfields" class="pure-form pure-form-stacked">
            <fieldset>
                <legend>Deine Daten prüfen und anpassen</legend>
                <div class="pure-g">
                    <div class="pure-u-1 pure-u-md-1-2">
                        <label for="firstname">Vorname</label>
                        <input type="text" id="firstname" style="width:99%" placeholder="Max" oninput="updatePreview()" onchange="saveToLocalStorage()"/>
                    </div>
                    <div class="pure-u-1 pure-u-md-1-2">
                        <label for="surname" >Nachname</label>
                        <input type="text" id="surname" style="width:99%" placeholder="Mustermann" oninput="updatePreview()" onchange="saveToLocalStorage()"/>
                    </div>
                    <div class="pure-u-1 pure-u-md-1-2">
                        <label for="position">Position</label>
                        <input type="text" id="position" style="width:99%" placeholder="Praktikant" oninput="updatePreview()" onchange="saveToLocalStorage()"/>
                    </div>
                    <div class="pure-u-1 pure-u-md-1-2">
                        <label for="department">Abteilung</label>
                        <input type="text" id="department" style="width:99%" placeholder="Kommunikation" oninput="updatePreview()" onchange="saveToLocalStorage()"/>
                    </div>
                    <div class="pure-u-1 pure-u-md-1-2">
                        <label for="departmentid">Abteilungskürzel</label>
                        <input type="text" id="departmentid" style="width:99%" placeholder="VV-WK" oninput="updatePreview()" onchange="saveToLocalStorage()"/>
                    </div>
                    <div class="pure-u-1 pure-u-md-1-2">
                        <label for="faxnr">Faxnummer</label>
                        <input type="text" id="faxnr" style="width:99%" placeholder="Faxnnummer" oninput="updatePreview()" onchange="saveToLocalStorage()"/>
                    </div>
                    <div class="pure-u-1 pure-u-md-1-2">
                        <label for="phonenr">Telefonnummer</label>
                        <input type="text" id="phonenr" style="width:99%" placeholder="0160 XXX XXX XXX" oninput="updatePreview()" onchange="saveToLocalStorage()"/>
                    </div>
                    <div class="pure-u-1 pure-u-md-1-2">
                        <label for="mobilenr">Mobilnummer</label>
                        <input type="text" id="mobilenr" style="width:99%" placeholder="0160 XXX XXX XXX" oninput="updatePreview()" onchange="saveToLocalStorage()"/>
                    </div>
                    <div class="pure-u-1 pure-u-md-1-2">
                        <label for="email">Email-Adresse</label>
                        <input type="text" id="email" style="width:99%" placeholder="max.mustermann@otto.de" oninput="updatePreview()" onchange="saveToLocalStorage()"/>
                    </div>
                    <div class="pure-u-1 pure-u-md-1-2" style="text-align: center">
                        <label for="copySignatureButton"><br></label>
                        <button type="button" class="pure-button" id="copySignatureButton" onclick="copyToClip()">In die Zwischenablage kopieren</button>
                        <button type="button" class="pure-button" onclick="toggleHelp()">Hilfe</button>
                    </div>
                </div>
            </fieldset>
        </form>
    </div>
</div>
<div class="outputbox" style="margin-top: 1%;">
    <h2>Signatur:</h2>
    <div class="preview">
        <form id="outputfield" class="pure-form">
        </form>
    </div>
</div>
<div id="help" class="help">
    <button id="close" onclick="toggleHelp()">&times;</button>
    <h2>Nutzungsanleitung</h2>
    <p>
        1. Persönliche Daten eintragen. Bei Freilassen des Telefax-Feldes wird die dazugehörige Zeile aus der Signatur gelöscht. Bei Freilassen des Email-Feldes wird diese aus Vor- und Nachname automatisch generiert.<br>
    </p>
    <p>
        2. Durch Klicken des "In die Zwischenablage kopieren" Knopfes befindet sich die Signatur nun in der Zwischenablage und kann zu den Outlook-Signaturen hinzugefügt werden. <br>
    </p>
    <p>
        3. Outlook über einen Browser öffnen. <br>
    </p>
    <p>
        4. Oben Rechts auf das Zahnrad und danach auf "Alle Outlook-Einstellungen anzeigen" (Englisch: "View all Outlook Settings") klicken. <br>
    </p>
    <p>
        5. In der linken Leiste erst das Feld "E-Mail" (Englisch: "Mail") und danach das Feld "Verfassen und Antworten" (E: "Compose and reply") auswählen. <br>
    </p>
    <p>
        6. Auf "+ Neue Signatur" ("+ New Signature") klicken. Nun kann der Signatur im ersten Feld einen Namen gegeben werden. Im zweiten Feld kann nun die zuvor erzeugte Signatur mit Drücken von STRG und V oder mit einem Rechtsclick gefolgt von einem Klick auf "Einfügen" hinzugefügt werden.<br>
    </p>
    <p>
        7. Unter dem Eingabefeld kann die Signatur nun als Standardsignatur für neue Nachrichten sowie Antworten und Weiterleitungen festgelegt werden.<br>
    </p>
    <p>
        8. Mit Betätigung des "Speichern"-Knopfes am unteren rechten Rand des Fensters wird nun die neue Signatur gespeichert.
    </p>
</div>
</div>
<div id="englishcontent" style="display:none;">
    <div id="languagebuttonsen" style="text-align: right; font-size:20px">
        <button class="languagebutton" onclick="setLanguage('german')">&#x1F1E9;&#x1F1EA;</button>
        <button class="languagebutton" onclick="setLanguage('english')">&#x1F1EC;&#x1F1E7;</button>
    </div>
    <h2>ENGLISH CONTENT TODO</h2>
</div>
<script>

// load input field contents from local storage
window.onload = function () {
    let fields = document.getElementById("inputfields");
    for (let i = 0; i< fields.length; i++){
        fields[i].value = localStorage.getItem(fields[i].id);
    }

    let language = localStorage.getItem("language");
    if(language) {
        var languagediv = document.getElementById(language + "content");
    } else {
        var languagediv = document.getElementById("germancontent");
    }
    languagediv.style.display = "inline";

    updatePreview();
}

// Saves user input to local storage
function saveToLocalStorage() {
    let fields = document.getElementById("inputfields");
    for (let i = 0; i< fields.length; i++){
        localStorage.setItem(fields[i].id, fields[i].value);
    }
}

function updatePreview() {
    document.getElementById("outputfield").innerHTML = generateRichSignature(document.getElementById("inputfields"));
}

function generateRichSignature(fields) {
    return "<span style='font-size:10.0pt; font-family:&quot;Arial&quot;,sans-serif; color:black'> ___________________________________________________________________<br><br>" + fields[1].value + " " + fields[2].value +  "<br>" + fields[3].value + " • "  + fields[4].value + " • " + fields[5].value + "<br><br>Otto (GmbH & Co KG) • Werner-Otto-Straße 1-7 • 22179 Hamburg<br>A member of the Otto Group<br>" + checkIfPhoneMobileTelefaxAreSet(fields[6].value, fields[7].value, fields[8].value) + "<br>" + checkIfEmailIsSet(fields[1].value, fields[2].value, fields[9].value) + "<br>___________________________________________________________________<br><br>www.otto.de<br>www.facebook.com/otto<br>www.twitter.com/otto_de<br>___________________________________________________________________</span><br><br><span style='font-size:8.0pt; font-family:&quot;Arial&quot;,sans-serif; color:black'>AG Hamburg, HR A 62 024, Persönlich haftend: Verwaltungsgesellschaft Otto GmbH,<br>Hamburg, AG Hamburg, HR B 13 762 vertr. durch: Alexander Birken (Vorsitzender) • <br>Dr. Marcus Ackermann • Sergio Bucher • Sebastian Klauke • Petra Scharner-Wolff • Kay Schiebur<br><br>Bereichsvorstände OTTO: Marc Opelt (Vorsitzender) • Bodo Kipper •<br>Dr. Michael Müller-Wünsch • Katy Roewer (jeweils Handlungsbevollmächtigte)<br><br>Aufsichtsrat: Prof. Dr. Michael Otto (Vorsitzender)<br></span><span style='font-size:10.0pt; font-family:&quot;Arial&quot;,sans-serif; color:black'>___________________________________________________________________</span><br><br><span style='font-size:10.0pt; font-family:&quot;Arial&quot;,sans-serif; color:#00B050'>SAVE PAPER - THINK BEFORE YOU PRINT</span>";
}

function generatePlainSignature(fields) {
    return "___________________________________________________________________\n\n" + fields[1].value + " " + fields[2].value +  "\n" + fields[3].value + " • "  + fields[4].value + " • " + fields[5].value + "\n\nOtto (GmbH & Co KG) • Werner-Otto-Straße 1-7 • 22179 Hamburg\nA member of the Otto Group\n" + checkIfPhoneMobileTelefaxAreSet(fields[6].value, fields[7].value, fields[8].value) + "\n" + checkIfEmailIsSet(fields[1].value, fields[2].value, fields[9].value) + "\n___________________________________________________________________\n\nwww.otto.de\nwww.facebook.com/otto\nwww.twitter.com/otto_de\n___________________________________________________________________\n\nAG Hamburg, HR A 62 024, Persönlich haftend: Verwaltungsgesellschaft Otto GmbH,\nHamburg, AG Hamburg, HR B 13 762 vertr. durch: Alexander Birken (Vorsitzender) • \nDr. Marcus Ackermann • Sergio Bucher • Sebastian Klauke • Petra Scharner-Wolff • Kay Schiebur\n\nBereichsvorstände OTTO: Marc Opelt (Vorsitzender) • Bodo Kipper •\nDr. Michael Müller-Wünsch • Katy Roewer (jeweils Handlungsbevollmächtigte)\n\nAufsichtsrat: Prof. Dr. Michael Otto (Vorsitzender)\n___________________________________________________________________\n\nSAVE PAPER - THINK BEFORE YOU PRINT";
}

// Reads user input, stores it in local storage and inserts the generated signature to clipboard
function copyToClip() {
  let fields = document.getElementById("inputfields");
  saveToLocalStorage();

  function listener(e) {
    e.clipboardData.setData("text/html", generateRichSignature(fields));
    e.clipboardData.setData("text/plain", generatePlainSignature(fields));
    e.preventDefault();
  }
  document.addEventListener("copy", listener);
  document.execCommand("copy");
  document.removeEventListener("copy", listener);

  alert("Signatur in Zwischenablage kopiert");
}

// show or hide help box
function toggleHelp() {
    let help = document.getElementById("help");
    if (help.style.display === "none") {
        help.style.display = 'inline';
    } else {
        help.style.display = 'none';
    }
}

// Since sometimes not all 3 fields are given, formats the line correctly and causes no doubled or missing "•"
function checkIfPhoneMobileTelefaxAreSet(faxField, phonenrField, mobilenrField) {
    // TODO clean this up
    let fax = "", phonenr =  "", mobilenr = "";

    if (phonenrField) phonenr = "Telefon " + phonenrField;

    if (faxField && phonenrField && mobilenrField) fax = " • Telefax " + faxField + " • ";
    else if (faxField && phonenrField) fax = " • Telefax " + faxField;
    else if (faxField && mobilenrField) fax = "Telefax " + faxField + " • ";
    else if (faxField) fax = "Telefax " + faxField;

    if (mobilenrField && phonenrField && !faxField) mobilenr = " • Mobiltelefon " + mobilenrField;
    else if (mobilenrField) mobilenr = "Mobiltelefon " + mobilenrField;

    return phonenr + fax + mobilenr;
}

// If email field is empty, generate email from first and surname
function checkIfEmailIsSet(name, surname, emailField) {
    if(emailField){
        return emailField;
    } else {
        return name.toLowerCase() + "." + surname.toLowerCase() + "@otto.de";
    }
}

function setLanguage(language) {
    localStorage.setItem("language", language);
    location.reload();
}
</script>

<style>

html, body {
    height: 100%;
    padding: 1em;
    font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
    font-size: 15px;
    color: #b9b9b9;
    background-color: #e3e3e3;
}

h2 {
    text-align: center;
}

.inputbox, .outputbox {
    max-width: 80%;
    padding: 1em 3em 2em 3em;
    margin: 0em auto;
    background-color: #fff;
    border-radius: 4.2px;
    box-shadow: 0px 3px 10px -2px rgba(0, 0, 0, 0.2);
}

.button-secondary {
    background: rgb(66, 184, 221);
}

.preview{
    text-align: left;
    margin:auto;
    width:50%;
    border:1px solid lightgrey;
    padding: 30px 40px;
    box-shadow: 0px 3px 10px -2px rgba(0, 0, 0, 0.2);
}

.help {
    display: none;
    color: black;
    border:1px solid black;
    background-color: #ffffff;
    width: 420px;
    padding: 30px 40px;
    position: absolute;
    transform: translate(-50%,-50%);
    left: 50%;
    top: 50%;
    display: none;
    text-align: center;
}

.help button{
    display: block;
    margin:  0 0 20px auto;
    cursor: pointer;
}

.help h2{
    margin-top: -20px;
}

.help p{
    font-size: 14px;
    text-align: justify;
    margin: 20px 0;
    line-height: 25px;
}

</style>
</body>
</html>
